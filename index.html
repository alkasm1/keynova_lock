<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Keynova Lock</title>

  <!-- Ø±ÙˆØ§Ø¨Ø· PWA ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon.png" type="image/png" />
  <meta name="theme-color" content="#ff8800" />

  <!-- ØªØ³Ø¬ÙŠÙ„ Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js");
    }
  </script>

  <!-- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ© Ø¨Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ -->
  <style>
    body {
      font-family: 'Tajawal', Arial, sans-serif;
      background-color: #000;
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    input[type="file"], button, select {
      margin-top: 10px;
      padding: 10px;
      font-size: 1em;
      border-radius: 6px;
    }

    button {
      background: #ff8800;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #e67600;
    }

    select {
      background: #2c2c2c;
      color: #fff;
      border: 1px solid #666;
    }

    .result {
      margin-top: 30px;
      font-size: 1.2em;
    }

    .success { color: #00ff99; }
    .fail { color: #ff4444; }
    h1 { color: #ff8800; }
  </style>
</head>
<body>

  <h1>ğŸ” Keynova Lock</h1>

  <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ù‚Ù‚ -->
  <h3>ğŸ”“ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙØªØ­</h3>
  <input type="file" id="verifyInput" accept="image/*" />
  <button onclick="verifyKey()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©</button>
  <div class="result" id="result"></div>

  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ -->
  <div id="securedActions" style="display:none;">
    <h3>ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Keynova</h3>
    <button onclick="goToKeyChange()">ğŸ› ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙØªØ§Ø­</button>
    <button onclick="goToProtection()">ğŸ—‚ï¸ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ù„ÙØ§Øª / Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</button>
    <button onclick="removeKey()">ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙØªØ§Ø­</button>
  </div>

  <!-- ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙØªØ§Ø­ -->
  <div id="keySection" style="display:none;">
    <h3>ğŸ–¼ï¸ ØªØ¹ÙŠÙŠÙ† ØµÙˆØ±Ø© ÙƒÙ…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯</h3>
    <input type="file" id="setKeyInput" accept="image/*" />
    <button onclick="setKey()">Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­</button>
  </div>

  <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ© -->
  <div id="protectionSection" style="display:none;">
    <h3>ğŸ›¡ï¸ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ©</h3>
    <select id="protectedTarget">
      <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ù‡Ø¯Ù â€”</option>
      <option value="images">ğŸ“¸ Ø§Ù„ØµÙˆØ±</option>
      <option value="docs">ğŸ“„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</option>
      <option value="apps">ğŸ“± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</option>
      <option value="custom">ğŸ§© Ù…Ø®ØµØµ</option>
    </select>
    <br />
    <button onclick="protectSelected()">ğŸ”’ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</button>
    <button onclick="clearProtection()">ğŸ§¹ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</button>

    <div class="result" id="protectionStatus"></div>
  </div>

  <!-- Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© -->
  <script>
    async function calculateHash(file) {
      const buffer = await file.arrayBuffer();
      const hashBuffer = await crypto.subtle.digest("SHA-256", buffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function verifyKey() {
      const file = document.getElementById("verifyInput").files[0];
      if (!file) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡Ø§");

      const storedHash = localStorage.getItem("keynova_hash");
      if (!storedHash) {
        alert("ğŸ”’ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­ Ù…Ø­ÙÙˆØ¸ØŒ ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ† Ù…ÙØªØ§Ø­ Ø£ÙˆÙ„Ù‹Ø§");
        goToKeyChange();
        return;
      }

      const currentHash = await calculateHash(file);
      const resultDiv = document.getElementById("result");

      if (currentHash === storedHash) {
        resultDiv.innerHTML = "âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!";
        resultDiv.className = "result success";
        document.getElementById("securedActions").style.display = "block";

        setTimeout(() => {
          alert("â³ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù‚Ù‚");
          document.getElementById("securedActions").style.display = "none";
          document.getElementById("keySection").style.display = "none";
          document.getElementById("protectionSection").style.display = "none";
        }, 600000);
      } else {
        resultDiv.innerHTML = "âŒ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø§ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…ÙØªØ§Ø­.";
        resultDiv.className = "result fail";
      }
    }

    async function setKey() {
      const file = document.getElementById("setKeyInput").files[0];
      if (!file) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù„ØªØ¹ÙŠÙŠÙ†Ù‡Ø§");

      const confirmChange = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙØªØ§Ø­ØŸ");
      if (!confirmChange) return;

      const hash = await calculateHash(file);
      localStorage.setItem("keynova_hash", hash);
      alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­");
    }

    function goToKeyChange() {
      document.getElementById("keySection").style.display = "block";
    }

    function goToProtection() {
      document.getElementById("protectionSection").style.display = "block";
      const storedTarget = localStorage.getItem("protected_target");
      const statusDiv = document.getElementById("protectionStatus");

      if (storedTarget) {
        statusDiv.innerHTML = `âœ… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…ÙØ¹Ù‘Ù„Ø© Ø¹Ù„Ù‰: <strong>${storedTarget}</strong>`;
        statusDiv.className = "result success";
      } else {
        statusDiv.innerHTML = "âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ø§ÙŠØ© Ø­Ø§Ù„ÙŠØ©";
        statusDiv.className = "result fail";
      }
    }

    function protectSelected() {
      const target = document.getElementById("protectedTarget").value;
      const statusDiv = document.getElementById("protectionStatus");

      if (!target) {
        statusDiv.innerHTML = "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø¯Ù";
        statusDiv.className = "result fail";
        return;
      }

      localStorage.setItem("protected_target", target);
      statusDiv.innerHTML = `âœ… ØªÙ… Ø­Ù…Ø§ÙŠØ©: <strong>${target}</strong>`;
      statusDiv.className = "result success";
    }

    function clearProtection() {
      localStorage.removeItem("protected_target");
      const statusDiv = document.getElementById("protectionStatus");
      statusDiv.innerHTML = "ğŸ§¹ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ù…Ø§ÙŠØ©";
      statusDiv.className = "result fail";
    }

    function removeKey() {
      const confirmDelete = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙØªØ§Ø­ØŸ");
      if (!confirmDelete) return;

      localStorage.removeItem("keynova_hash");
      alert("âœ… ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙØªØ§Ø­");
      document.getElementById("securedActions").style.display = "none";
    }
  </script>

</body>
</html>
