<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Keynova Lock</title>
  <link rel="manifest" href="manifest.json" />
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js");
    }
  </script>
  <style>
    body { font-family: Arial; background: #121212; color: #fff; padding: 20px; text-align: center; }
    input[type="file"], button { margin-top: 10px; padding: 10px; font-size: 1em; }
    .result { margin-top: 30px; font-size: 1.2em; }
    .success { color: #00ff99; }
    .fail { color: #ff4444; }
  </style>
</head>
<body>

  <h1>ğŸ” Keynova Lock</h1>
  <p>Ø£Ø¯Ø®Ù„ ØµÙˆØ±ØªÙƒ Ù„Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>

  <h3>ğŸ”“ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙØªØ­</h3>
  <input type="file" id="verifyInput" accept="image/*" />
  <button onclick="verifyKey()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©</button>
  <div class="result" id="result"></div>

  <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ -->
  <div id="securedActions" style="display:none;">
    <h3>ğŸ”§ Ø®ÙŠØ§Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚</h3>
    <button onclick="goToKeyChange()">ğŸ› ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙØªØ§Ø­</button>
    <button onclick="goToProtection()">ğŸ—‚ï¸ Ø­Ù…Ø§ÙŠØ© ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ù…Ù„Ù</button>
  </div>

  <!-- ÙˆØ§Ø¬Ù‡Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙØªØ§Ø­ -->
  <div id="keySection" style="display:none;">
    <h3>ğŸ–¼ï¸ ØªØ¹ÙŠÙŠÙ† ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙƒÙ…ÙØªØ§Ø­</h3>
    <input type="file" id="setKeyInput" accept="image/*" />
    <button onclick="setKey()">Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯</button>
  </div>

  <script>
    async function calculateHash(file) {
      const buffer = await file.arrayBuffer();
      const hashBuffer = await crypto.subtle.digest("SHA-256", buffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function verifyKey() {
      const file = document.getElementById("verifyInput").files[0];
      if (!file) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡Ø§");

      const storedHash = localStorage.getItem("keynova_hash");
      if (!storedHash) {
        document.getElementById("result").innerHTML = "âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ù…ÙØªØ§Ø­ Ù…Ù† Ù‚Ø¨Ù„!";
        document.getElementById("result").className = "result fail";
        return;
      }

      const currentHash = await calculateHash(file);
      const resultDiv = document.getElementById("result");

      if (currentHash === storedHash) {
        resultDiv.innerHTML = "âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.";
        resultDiv.className = "result success";
        document.getElementById("securedActions").style.display = "block";
      } else {
        resultDiv.innerHTML = "âŒ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø§ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø®Ø²Ù†.";
        resultDiv.className = "result fail";
      }
    }

    async function setKey() {
      const file = document.getElementById("setKeyInput").files[0];
      if (!file) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ÙƒÙ…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯");
      const hash = await calculateHash(file);
      localStorage.setItem("keynova_hash", hash);
      alert("âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!");
    }

    function goToKeyChange() {
      document.getElementById("keySection").style.display = "block";
    }

    function goToProtection() {
      alert("ğŸ›¡ï¸ Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù‡Ù†Ø§!");
    }
  </script>

</body>
</html>
